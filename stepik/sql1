В вашей базе данных с описанной ниже схемой хранятся данные о полётах на планеты с тем или иным политическим строем. Вам нужно посчитать локальный и глобальный ранг каждой планеты по количеству полётов на неё.

В отсортированной числовой выборке под рангом понимается порядковый номер элемента выборки. Одинаковым элементам присваивается одинаковый ранг, равный суммарному количеству всех предыдущих элементов + 1.

Под рангом планеты понимается ранг количества полётов на неё в каком-то множестве планет. Под локальным рангом планеты понимается ранг среди всех планет с таким же политическим строем. Под глобальным рангом понимается ранг среди всех планет.

Нумерация начинается с единицы. Сортировка количества полётов производится в убывающем порядке. Планета с наибольшим количеством полётов должна получить ранг 1.

with nt as (select name, value, count (date) as cnt
			from Planet p
			left join Flight f on p.id = f.planet_id
			left join PoliticalSystem ps on p.psystem_id=ps.id
           	group by name, value),
lr as (select *,
       rank() over (partition by value order by cnt desc) as local_rank
      from nt),
gr as (select *,
       rank() over (order by cnt desc) as "global_rank"
       from lr)

select name as "planet", value as "psystem", local_rank, global_rank
from gr

~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
[No Name][+] [unix] (02:59 01/01/1970)                                   3,1 All
-- INSERT --

